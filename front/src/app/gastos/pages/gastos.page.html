<div class="min-h-screen bg-gradient-to-br from-red-600 to-red-800 p-4">
  <!-- Header -->
  <div class="max-w-6xl mx-auto mb-6">
    <div class="text-center mb-6">
      <div class="mx-auto flex flex-col items-center justify-center mb-3">
        <div class="logo-svg-container mb-3">
          <svg
            width="48"
            height="48"
            viewBox="0 0 64 64"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="32" r="32" fill="url(#paint0_linear)" />
            <path
              d="M20 40V24C20 21.7909 21.7909 20 24 20H40C42.2091 20 44 21.7909 44 24V40C44 42.2091 42.2091 44 40 44H24C21.7909 44 20 42.2091 20 40Z"
              fill="white" />
            <path d="M32 28V36" stroke="#dc2626" stroke-width="2.5" stroke-linecap="round" />
            <path d="M28 32H36" stroke="#dc2626" stroke-width="2.5" stroke-linecap="round" />
            <defs>
              <linearGradient
                id="paint0_linear"
                x1="0"
                y1="0"
                x2="64"
                y2="64"
                gradientUnits="userSpaceOnUse">
                <stop stop-color="#dc2626" />
                <stop offset="1" stop-color="#991b1b" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <h2 class="text-2xl font-extrabold page-title mb-1">Gestión de Gastos</h2>
        <p class="text-red-200 text-sm">Registra y administra tus gastos y egresos</p>
      </div>
    </div>
  </div>

  <!-- Content Container -->
  <div class="max-w-6xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Form Section -->
      <div class="content-card rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center space-x-2">
            <mat-icon class="text-red-500">{{ editingId ? 'edit' : 'add_circle' }}</mat-icon>
            <span>{{ editingId ? 'Editar Gasto' : 'Nuevo Gasto' }}</span>
          </h3>
          <button
            *ngIf="editingId"
            mat-icon-button
            (click)="resetForm()"
            matTooltip="Cancelar edición"
            class="text-gray-500 hover:text-gray-700">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <!-- Success/Error Message -->
        <div
          *ngIf="showMessageFlag"
          class="mb-4 p-3 rounded-lg border"
          [ngClass]="{
            'bg-green-50 border-green-200': message.includes('exitosamente'),
            'bg-red-50 border-red-200': !message.includes('exitosamente'),
          }">
          <div class="flex items-center space-x-2">
            <mat-icon
              [ngClass]="{
                'text-green-600': message.includes('exitosamente'),
                'text-red-600': !message.includes('exitosamente'),
              }">
              {{ message.includes('exitosamente') ? 'check_circle' : 'error' }}
            </mat-icon>
            <span
              [ngClass]="{
                'text-green-700': message.includes('exitosamente'),
                'text-red-700': !message.includes('exitosamente'),
              }"
              class="text-sm">
              {{ message }}
            </span>
          </div>
        </div>

        <!-- Expense Form -->
        <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <!-- Amount Input -->
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              type="number"
              formControlName="amount"
              placeholder="Cantidad*"
              class="text-lg" />
            <mat-icon matSuffix class="text-gray-400">payments</mat-icon>
            <mat-error>{{ getFieldError('amount') }}</mat-error>
          </mat-form-field>

          <!-- Description Field -->
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              formControlName="description"
              placeholder="Describe tu gasto..."
              class="text-lg" />
            <mat-icon matSuffix class="text-gray-400">description</mat-icon>
            <mat-error>{{ getFieldError('description') }}</mat-error>
          </mat-form-field>

          <!-- Date and Category Row -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Date Field -->
            <mat-form-field appearance="outline" class="w-full">
              <input
                matInput
                [matDatepicker]="picker"
                placeholder="Fecha*"
                formControlName="date"
                class="text-lg" />
              <mat-hint>Selecciona la fecha del gasto</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error>{{ getFieldError('date') }}</mat-error>
            </mat-form-field>

            <!-- Category Field -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-select formControlName="category" placeholder="Categoría*" class="text-lg">
                <mat-select-trigger>
                  <div
                    class="flex items-center space-x-2"
                    *ngIf="expenseForm.get('category')?.value !== null">
                    <mat-icon class="text-red-500">
                      {{ getCategoryIcon(expenseForm.get('category')?.value) }}
                    </mat-icon>
                    <span>{{ getCategoryLabel(expenseForm.get('category')?.value) }}</span>
                  </div>
                </mat-select-trigger>
                <mat-option *ngFor="let category of expenseCategories" [value]="category.value">
                  <div class="flex items-center space-x-2">
                    <mat-icon class="text-red-500">{{ category.icon }}</mat-icon>
                    <span>{{ category.label }}</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-error>{{ getFieldError('category') }}</mat-error>
            </mat-form-field>
          </div>

          <!-- Type Field -->
          <mat-form-field appearance="outline" class="w-full">
            <mat-select formControlName="type" placeholder="Tipo de Gasto*" class="text-lg">
              <mat-select-trigger>
                <div
                  class="flex items-center space-x-2"
                  *ngIf="expenseForm.get('type')?.value !== null">
                  <mat-icon class="text-red-500">
                    {{ getTypeIcon(expenseForm.get('type')?.value) }}
                  </mat-icon>
                  <span>{{ getTypeLabel(expenseForm.get('type')?.value) }}</span>
                </div>
              </mat-select-trigger>
              <mat-option *ngFor="let type of expenseTypes" [value]="type.value">
                <div class="flex items-center space-x-2">
                  <mat-icon class="text-red-500">{{ type.icon }}</mat-icon>
                  <span>{{ type.label }}</span>
                </div>
              </mat-option>
            </mat-select>
            <mat-error>{{ getFieldError('type') }}</mat-error>
          </mat-form-field>

          <!-- Submit Button -->
          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="w-full h-12 text-lg font-semibold rounded-lg"
            [disabled]="!expenseForm.valid || isLoading">
            <div *ngIf="isLoading" class="flex items-center justify-center space-x-2">
              <mat-spinner diameter="20"></mat-spinner>
              <span>{{ editingId ? 'Actualizando...' : 'Guardando...' }}</span>
            </div>
            <span *ngIf="!isLoading" class="flex items-center justify-center space-x-2">
              <mat-icon>{{ editingId ? 'save' : 'add' }}</mat-icon>
              <span>{{ editingId ? 'Actualizar Gasto' : 'Agregar Gasto' }}</span>
            </span>
          </button>
        </form>

        <!-- Form Tips -->
        <div class="mt-6">
          <div class="form-tips rounded-xl p-3">
            <div class="flex items-start space-x-2">
              <mat-icon class="text-sm text-red-600 mt-0.5">lightbulb</mat-icon>
              <div class="text-xs text-gray-600">
                <p class="font-medium text-gray-900 mb-1">Consejos para registrar gastos:</p>
                <ul class="space-y-0.5">
                  <li>• Registra todos tus gastos para un mejor control</li>
                  <li>• Categoriza correctamente para análisis precisos</li>
                  <li>• Usa descripciones claras y específicas</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Table Section -->
      <div class="content-card rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center space-x-2">
            <mat-icon class="text-red-500">list</mat-icon>
            <span>Mis Gastos</span>
          </h3>
          <div class="flex items-center space-x-2 text-sm text-gray-600">
            <mat-icon class="text-red-500">account_balance_wallet</mat-icon>
            <span>Total: ${{ getTotalExpenses() | number: '1.2-2' }}</span>
          </div>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex items-center justify-center py-12">
          <mat-spinner diameter="40"></mat-spinner>
        </div>

        <!-- No Data State -->
        <div *ngIf="!isLoading && dataSource.data.length === 0" class="text-center py-12">
          <mat-icon class="text-gray-400 text-6xl mb-4">receipt</mat-icon>
          <p class="text-gray-600 text-lg mb-2">No hay gastos registrados</p>
          <p class="text-gray-500">Agrega tu primer gasto usando el formulario</p>
        </div>

        <!-- Data Table -->
        <div *ngIf="!isLoading && dataSource.data.length > 0" class="overflow-hidden">
          <table mat-table [dataSource]="dataSource" class="w-full">
            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Cantidad</th>
              <td mat-cell *matCellDef="let expense" class="font-medium">
                <span class="text-red-600 font-semibold">
                  ${{ expense.amount | number: '1.2-2' }}
                </span>
              </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Descripción</th>
              <td mat-cell *matCellDef="let expense" class="max-w-xs">
                <div class="truncate" [title]="expense.description">
                  {{ expense.description }}
                </div>
              </td>
            </ng-container>

            <!-- Category Column -->
            <ng-container matColumnDef="category">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Categoría</th>
              <td mat-cell *matCellDef="let expense">
                <div class="flex items-center space-x-2">
                  <mat-icon class="text-red-500 text-sm">
                    {{ getCategoryIcon(expense.category) }}
                  </mat-icon>
                  <span>{{ getCategoryLabel(expense.category) }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Type Column -->
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Tipo</th>
              <td mat-cell *matCellDef="let expense">
                <div class="flex items-center space-x-2">
                  <mat-icon class="text-red-500 text-sm">{{ getTypeIcon(expense.type) }}</mat-icon>
                  <span>{{ getTypeLabel(expense.type) }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef class="font-semibold">Fecha</th>
              <td mat-cell *matCellDef="let expense">
                {{ expense.date | date: 'dd/MM/yyyy' }}
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="font-semibold text-center">Acciones</th>
              <td mat-cell *matCellDef="let expense" class="text-center">
                <div class="flex items-center justify-center space-x-1">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="editExpense(expense)"
                    matTooltip="Editar">
                    <mat-icon class="text-lg">edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteExpense(expense.id)"
                    matTooltip="Eliminar">
                    <mat-icon class="text-lg">delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumns"
              class="hover:bg-gray-50 transition-colors duration-200"></tr>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
