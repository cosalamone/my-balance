<div class="min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 p-4">
  <!-- Header -->
  <div class="max-w-6xl mx-auto mb-6">
    <div class="text-center mb-6">
      <div class="mx-auto flex flex-col items-center justify-center mb-3">
        <div class="logo-svg-container mb-3">
          <svg
            width="48"
            height="48"
            viewBox="0 0 64 64"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="32" r="32" fill="url(#paint0_linear)" />
            <path
              d="M20 40V24C20 21.7909 21.7909 20 24 20H40C42.2091 20 44 21.7909 44 24V40C44 42.2091 42.2091 44 40 44H24C21.7909 44 20 42.2091 20 40Z"
              fill="white" />
            <path d="M32 28V36" stroke="#2563eb" stroke-width="2.5" stroke-linecap="round" />
            <path d="M28 32H36" stroke="#2563eb" stroke-width="2.5" stroke-linecap="round" />
            <defs>
              <linearGradient
                id="paint0_linear"
                x1="0"
                y1="0"
                x2="64"
                y2="64"
                gradientUnits="userSpaceOnUse">
                <stop stop-color="#2563eb" />
                <stop offset="1" stop-color="#1e40af" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <h2 class="text-2xl font-extrabold page-title mb-1">Gestión de Ahorros</h2>
        <p class="text-blue-200 text-sm">Registra y administra tus ahorros y metas financieras</p>
      </div>
    </div>
  </div>

  <!-- Content Container -->
  <div class="max-w-6xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <!-- Form Section -->
      <div class="content-card rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center space-x-2">
            <mat-icon class="text-blue-500">{{ editingId ? 'edit' : 'add_circle' }}</mat-icon>
            <span>{{ editingId ? 'Editar Ahorro' : 'Nuevo Ahorro' }}</span>
          </h3>
          <button
            *ngIf="editingId"
            mat-icon-button
            (click)="resetForm()"
            matTooltip="Cancelar edición"
            class="text-gray-500 hover:text-gray-700">
            <mat-icon>close</mat-icon>
          </button>
        </div>

        <!-- Success/Error Message -->
        <div
          *ngIf="showMessageFlag"
          class="mb-4 p-3 rounded-lg border"
          [ngClass]="{
            'bg-green-50 border-green-200': message.includes('exitosamente'),
            'bg-red-50 border-red-200': !message.includes('exitosamente'),
          }">
          <div class="flex items-center space-x-2">
            <mat-icon
              [ngClass]="{
                'text-green-600': message.includes('exitosamente'),
                'text-red-600': !message.includes('exitosamente'),
              }">
              {{ message.includes('exitosamente') ? 'check_circle' : 'error' }}
            </mat-icon>
            <span
              [ngClass]="{
                'text-green-700': message.includes('exitosamente'),
                'text-red-700': !message.includes('exitosamente'),
              }"
              class="text-sm">
              {{ message }}
            </span>
          </div>
        </div>

        <!-- Form -->
        <form [formGroup]="savingsForm" (ngSubmit)="onSubmit()" class="space-y-4">
          <!-- Amount Field -->
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              type="number"
              step="0.01"
              min="0"
              formControlName="amount"
              placeholder="Cantidad*"
              class="text-lg" />
            <mat-icon matSuffix class="text-gray-400">savings</mat-icon>
            <mat-error>{{ getFieldError('amount') }}</mat-error>
          </mat-form-field>

          <!-- Description Field -->
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              formControlName="description"
              placeholder="Describe tu ahorro..."
              maxlength="500"
              class="text-lg" />
            <mat-icon matSuffix class="text-gray-400">description</mat-icon>
            <mat-error>{{ getFieldError('description') }}</mat-error>
          </mat-form-field>

          <!-- Date and Category Row -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Date Field -->
            <mat-form-field appearance="outline" class="w-full">
              <input
                matInput
                [matDatepicker]="datePicker"
                placeholder="Fecha*"
                formControlName="date"
                class="text-lg" />
              <mat-hint>Selecciona la fecha del ahorro</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="datePicker"></mat-datepicker-toggle>
              <mat-datepicker #datePicker></mat-datepicker>
              <mat-error>{{ getFieldError('date') }}</mat-error>
            </mat-form-field>

            <!-- Category Field -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-select formControlName="category" placeholder="Categoría*" class="text-lg">
                <mat-option *ngFor="let category of savingsCategories" [value]="category.value">
                  <div class="flex items-center space-x-2">
                    <mat-icon class="text-gray-500">{{ category.icon }}</mat-icon>
                    <span>{{ category.label }}</span>
                  </div>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix class="text-gray-400">category</mat-icon>
              <mat-error>{{ getFieldError('category') }}</mat-error>
            </mat-form-field>
          </div>

          <!-- Goal Amount and Target Date Row -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Goal Amount Field -->
            <mat-form-field appearance="outline" class="w-full">
              <input
                matInput
                type="number"
                step="0.01"
                min="0"
                formControlName="goalAmount"
                placeholder="Meta de Ahorro (Opcional)"
                class="text-lg" />
              <mat-icon matSuffix class="text-gray-400">flag</mat-icon>
              <mat-hint>Establece una meta para este ahorro</mat-hint>
            </mat-form-field>

            <!-- Target Date Field -->
            <mat-form-field appearance="outline" class="w-full">
              <input
                matInput
                [matDatepicker]="targetDatePicker"
                placeholder="Fecha Objetivo (Opcional)"
                formControlName="targetDate"
                class="text-lg" />
              <mat-hint>Cuándo planeas alcanzar la meta</mat-hint>
              <mat-datepicker-toggle matIconSuffix [for]="targetDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #targetDatePicker></mat-datepicker>
            </mat-form-field>
          </div>

          <!-- Action Buttons -->
          <div class="flex space-x-3 pt-4">
            <button
              type="button"
              mat-stroked-button
              (click)="resetForm()"
              [disabled]="isLoading"
              class="flex-1 md:flex-none">
              <mat-icon class="mr-2">clear</mat-icon>
              Limpiar
            </button>
            <button
              type="submit"
              mat-raised-button
              color="primary"
              [disabled]="savingsForm.invalid || isLoading"
              class="flex-1 md:flex-none">
              <mat-spinner *ngIf="isLoading" diameter="20" class="mr-2"></mat-spinner>
              <mat-icon *ngIf="!isLoading" class="mr-2">{{ editingId ? 'save' : 'add' }}</mat-icon>
              {{ editingId ? 'Actualizar' : 'Guardar' }} Ahorro
            </button>
          </div>
        </form>
      </div>

      <!-- List Section -->
      <div class="content-card rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900 flex items-center space-x-2">
            <mat-icon class="text-blue-500">list</mat-icon>
            <span>Mis Ahorros</span>
          </h3>
          <div class="text-right" *ngIf="dataSource.data.length > 0">
            <div class="text-xs text-gray-500">Total Ahorrado</div>
            <div class="text-lg font-bold text-blue-600">
              ${{ getTotalSavings() | number: '1.2-2' }}
            </div>
          </div>
        </div>

        <!-- Filter -->
        <div class="mb-4" *ngIf="dataSource.data.length > 0">
          <mat-form-field appearance="outline" class="w-full">
            <input
              matInput
              (keyup)="applyFilter($event)"
              placeholder="Buscar ahorros..."
              class="text-sm" />
            <mat-icon matSuffix class="text-gray-400">search</mat-icon>
          </mat-form-field>
        </div>

        <!-- Loading -->
        <div class="text-center py-8" *ngIf="isLoading && dataSource.data.length === 0">
          <mat-spinner diameter="40" class="mx-auto mb-4"></mat-spinner>
          <p class="text-gray-500">Cargando ahorros...</p>
        </div>

        <!-- No Data -->
        <div class="text-center py-8" *ngIf="!isLoading && dataSource.data.length === 0">
          <mat-icon class="text-6xl text-gray-300 mb-4">savings</mat-icon>
          <h4 class="text-lg font-medium text-gray-900 mb-2">No hay ahorros registrados</h4>
          <p class="text-gray-500 mb-4">
            Comienza agregando tu primer ahorro usando el formulario de al lado
          </p>
          <button mat-raised-button color="primary" (click)="scrollToForm()">
            <mat-icon class="mr-2">add</mat-icon>
            Agregar Ahorro
          </button>
        </div>

        <!-- Savings Table -->
        <div class="overflow-x-auto" *ngIf="dataSource.data.length > 0">
          <table mat-table [dataSource]="dataSource" class="w-full" matSort>
            <!-- Date Column -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-left">Fecha</th>
              <td mat-cell *matCellDef="let saving" class="text-sm">
                {{ saving.date | date: 'dd/MM/yyyy' }}
              </td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-left">
                Descripción
              </th>
              <td mat-cell *matCellDef="let saving" class="text-sm">
                <div class="flex items-center space-x-2">
                  <mat-icon class="text-gray-400 text-sm">
                    {{ getCategoryIcon(saving.category) }}
                  </mat-icon>
                  <span>{{ saving.description }}</span>
                </div>
                <div class="text-xs text-gray-500">{{ getCategoryLabel(saving.category) }}</div>
              </td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="text-right">Monto</th>
              <td mat-cell *matCellDef="let saving" class="text-right">
                <div class="font-semibold text-blue-600">
                  ${{ saving.amount | number: '1.2-2' }}
                </div>
                <div class="text-xs text-gray-500" *ngIf="saving.goalAmount">
                  Meta: ${{ saving.goalAmount | number: '1.2-2' }}
                </div>
              </td>
            </ng-container>

            <!-- Progress Column -->
            <ng-container matColumnDef="progress">
              <th mat-header-cell *matHeaderCellDef class="text-center">Progreso</th>
              <td mat-cell *matCellDef="let saving" class="text-center">
                <div *ngIf="saving.goalAmount" class="space-y-1">
                  <div class="w-full bg-gray-200 rounded-full h-2">
                    <div
                      class="h-2 rounded-full transition-all duration-300"
                      [ngClass]="{
                        'bg-blue-500': getProgress(saving) < 50,
                        'bg-yellow-500': getProgress(saving) >= 50 && getProgress(saving) < 100,
                        'bg-green-500': getProgress(saving) >= 100,
                      }"
                      [style.width.%]="getProgress(saving)"></div>
                  </div>
                  <div class="text-xs text-gray-600">
                    {{ getProgress(saving) | number: '1.0-0' }}%
                  </div>
                </div>
                <div *ngIf="!saving.goalAmount" class="text-xs text-gray-400">Sin meta</div>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="text-center">Acciones</th>
              <td mat-cell *matCellDef="let saving" class="text-center">
                <div class="flex justify-center space-x-1">
                  <button
                    mat-icon-button
                    color="primary"
                    (click)="editSaving(saving)"
                    matTooltip="Editar ahorro"
                    class="text-sm">
                    <mat-icon class="text-lg">edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    color="warn"
                    (click)="deleteSaving(saving.id)"
                    matTooltip="Eliminar ahorro"
                    class="text-sm">
                    <mat-icon class="text-lg">delete</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumns"
              class="hover:bg-gray-50 transition-colors duration-200"></tr>
          </table>

          <!-- Paginator -->
          <mat-paginator
            [pageSizeOptions]="[5, 10, 20]"
            showFirstLastButtons
            aria-label="Seleccione una página de ahorros"
            class="border-t"></mat-paginator>
        </div>
      </div>
    </div>
  </div>
</div>
